<!DOCTYPE html>
<html lang="en">
	<head>
		<title>{{.Action}} {{.Entry.Name}}</title>
		<link rel="icon" type="image/svg+xml" href="/icons/48.svg" sizes="48x48">
		<link rel="icon" type="image/png" href="/icons/48.png" sizes="48x48">		 
		<link rel="apple-touch-icon" href="/icons/192.png">

		<meta name="generator" content="Micro: a terminal-based plain text editor">
		<meta name="description" content="Enter your community service hours">
		<meta name="application-name" content="BBCS">

		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">

		<link rel="stylesheet" href="style.css">
		<meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no">
		<meta name="theme-color" content="#26428b">
		<link rel="manifest" href="/manifest.json">
		<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">

		<style>
@media print {
	.textfield {
		border: 0 !important;
		-moz-appearance: textfield;
		-webkit-appearance: textfield;
		appearance: textfield;
	}
	input::-webkit-outer-spin-button,
	input::-webkit-inner-spin-button {
		/* display: none; <- Crashes Chrome on hover */
		-webkit-appearance: none;
	}
    ::-webkit-input-placeholder { /* WebKit browsers */
        color: transparent;
    }
    :-moz-placeholder { /* Mozilla Firefox 4 to 18 */
       color: transparent;
    }
    ::-moz-placeholder { /* Mozilla Firefox 19+ */
       color: transparent;
    }
    :-ms-input-placeholder { /* Internet Explorer 10+ */
       color: transparent;
    }

	.button {
		display: none;
	}

	#lastmodified {
		display: none;
	}
}
		</style>
	</head>
	<body>
		{{if ne .Action "View"}}
		<form action="/update" method="POST">
		{{end}}
			<div class="title with-icon">
				<a href="/list?user={{.Student.Email}}" class="material-icons icon" aria-label="Back" {{if ne .Action "View"}} {{end}}>&#xe5c4;</a>
				<h1 style="flex-grow:1">{{.Action}} entry</h1>
				<span>{{.User.Email}}</span>
				<a href="/signout" class="button light">Sign out</a>		
			</div>
			<div class="title-spacer"></div>		
			<main>
				<input name="name" type="text" placeholder="Name (e.g. Soup Kitchen)" class="textfield" value="{{.Entry.Name}}" required {{if eq .Action "View"}}disabled{{end}}>
				<div class="flex flex-sm">
					<input name="hours" class="textfield" type="number" min="1" placeholder="Hours" required value="{{.Entry.Hours}}" {{if eq .Action "View"}}disabled{{end}} />
					<input name="date" class="textfield" type="date" {{if not .User.Admin}}min="{{(time -30).Format "2006-01-02"}}"{{end}} placeholder="yyyy-mm-dd" required pattern="[0-9]{4}-[0-9]{2}-[0-9]{2}" value="{{.Entry.Date.Format "2006-01-02"}}" placeholder="Date (e.g. 2018-10-31)" {{if eq .Action "View"}}disabled{{end}} />
				</div>
				<input name="entry" type="hidden" value="{{.EntryIndex}}">
				<input name="user" type="hidden" value="{{.Student.Email}}">
				<input name="org" class="textfield" type="text" placeholder="Service Organization" value="{{.Entry.Organization}}" required {{if eq .Action "View"}}disabled{{end}} />
				
				<div class="flex">
					<input name="contactname" class="textfield" type="text" placeholder="Contact Person" required value="{{.Entry.ContactName}}" {{if eq .Action "View"}}disabled{{end}} />
					<input name="contactemail" class="textfield" type="email" placeholder="Contact Email" value="{{.Entry.ContactEmail}}" {{if eq .Action "View"}}disabled{{end}} />
					<input name="contactphone" class="textfield" type="tel" placeholder="Contact Phone (e.g. +1 914-937-3600)"{{if ne .Entry.ContactPhone 0}} value="+{{.Entry.ContactPhone}}"{{end}} pattern="[0-9\-\+ ]+" {{if eq .Action "View"}}disabled{{end}} />
				</div>

				<textarea class="textfield" placeholder="Description" name="description">{{.Entry.Description}}</textarea>

				{{if ne .Action "Add"}}
				<div style="margin-top:8px" id="lastmodified"><small><b>{{.Entry.LastModified.Format "Jan 2, 2006"}}:</b> Last Modified</small></div>
				{{end}}
				
				{{if ne .Action "View"}}
					<button type="submit" class="button strong" onclick="removeAlert()" style="margin-top:8px">Save</button>
					<span style="float:right;margin-top:8px">
						{{if eq .Action "Edit"}}
							{{if and .User.Admin .Entry.Flagged}}
								<button formaction="/unflag" class="button" type="submit" style="margin-right:8px">Not Suspicious</button>
							{{end}}
							<button formaction="/delete" class="button" type="submit" onclick="return window.confirm('Are you sure you want to delete \'' + document.querySelector('[name=name]').value + '\'?')">Delete</button>
							<a class="button" href="/duplicate?entry={{.EntryIndex}}&user={{.Student.Email}}" style="margin-left:8px">Duplicate</a>
						{{end}}
						<a class="button" onclick="removeAlert()" style="margin-left:8px" href="/list?user={{.Student.Email}}">Cancel</a>
					</span>
				{{else}}
					<a class="button strong" href="/list?user={{.Student.Email}}" style="margin-top:8px">Back</a>
					<a class="button" href="/duplicate?entry={{.EntryIndex}}&user={{.Student.Email}}" style="margin-top:8px;float:right">Duplicate</a>
				{{end}}
			</main>
			{{if ne .Action "View"}}
			</form>
			{{end}}
        <script>
            var message = 'Leave? Changes will be lost'
            function removeAlert() {
                message = null
            }
            window.onbeforeunload = function() {
                return message
            }
        </script>
	</body>
</html>
